---
title: |
  <b>プレゼミ2024</b> </br>
  <span style="color: #282A36; ">第1回 プレゼミと分析とR</span>
author: "Soichi Matsuura"
format:
  revealjs:
    theme: ["default", "dracula.scss"]
    html-math-method: katex
    transition: convex
    slide-number: true
    df_print: paged
highlight-style: github
execute:
  echo: true
  warning: false
filters:
  - webr
---

# 松浦プレゼミへ</br> ようこそ

## 自己紹介


:::{.columns}

:::: {.column width="60%"}
- 松浦総一 (Soichi Matsuura)
- 博士 (経営学)(神戸大学)
- University of WashingtonやAalto Universityで客員研究員
- 財務会計や税務会計の実証研究
::::

:::: {.column width="40%"}


![Soichi Matsuura](img/kyouju.png)

::::

:::

## プレゼミの目標

- サクッとRでデータを分析したり、グラフや表を作成できるようになる。
- 文章作成とデータ分析を統合した環境Quarto/R markdownでレポートを作成できる。
- MS WordとMS Excelから脱却し、データ分析の効率性と再現可能性を高める。
- 複数人でプログラムの開発ができる。Git/GitHubでできる。(これは時間があれば)

## 今日の目標


第1回講義の**到達目標**は、

- プレゼミの内容と到達目標を理解する。
- Rを実行するための環境を構築する。
- RStudioかVS Codeを起動し、ファイルを開くことができる。
- Posit Cloudでファイルを開くことができる。
- ソースコードを書いて、実行することができる。

## プレゼミの教科書

:::{.columns}
::::{.column width="50%"}
- 松浦寿幸 著
- 「**Rによるデータ分析入門** -- 経済分析の基礎から因果推論まで」
- 東京図書
- 2024年4月発売
- 慶應義塾大学教授
::::

::::{.column width="50%"}
![Rによるデータ分析入門](img/matsuura_R_data.jpg){width=80%}
::::
:::

## 教科書の目次

:::{.columns}

::::{.column width="50%"}
- 第0章 Rとは
- 第1章 RとRstudioの<br>基本動作
- 第2章 Rによる統計表<br>の作成
- 第3章 回帰分析
::::

::::{.column width="50%"}
- 第4章 離散選択モデル・<br>質的データの分析
- 第5章 差の差の分析と<br>パネルデータ分析
- 第6章 操作変数法
- 第7章 傾向スコア法
::::

:::


## プレゼミの主要テーマ

[因果関係]{style="font-size:2em; color: #808923; weight: bold;"} causality

- ある個体のタイプを特定し、**処置**(treatment)とその処置に伴う**結果**(outcome)の対応関係を*因果関係*(causality)という。
- たとえば、テレビCMを流すことが売上に影響するかどうかを調べるとする。
- 個体はテレビを見ている人、**処置**はテレビCMを見せる、**結果**は売上の変化、**因果関係**はテレビCMが売上に影響するかどうかである。

## エクササイズ1

:::{.callout-important  icon="false"}
## 広告の効果

テレビCMを流したら、その後売上が上昇した。この場合、テレビCMが売上に影響したと言えるか？
:::

- どんなデータが必要か？
- どんな分析方法が適切か？
- どんな結果が得られると、説得的な結論が導けるか？


## エクササイズ2

:::{.callout-important  icon="false"}
## 取締役会のダイバーシティ

女性取締役の登用が企業の業績に与える影響を知りたい。
:::

- どんなデータが必要か？
- どんな分析方法が適切か？
- どんな結果が得られると、説得的な結論が導けるか？

## 大事なこと

会計でもマーケティングでも組織論でも因果推論で大事なことは、

1. 興味深いリサーチクエスチョンを設定し、
1. 明快な推論で導き出された**仮説**を、
2. 客観的な**データ**を用いて、
3. **適切な手法**で分析し、
4. その結果を**解釈**し、
5. 経営・会計にどのような影響・貢献があるかを

考えること。


# R 入門

## Rとは

- Rは統計解析やデータ処理のためのプログラミング言語
- いくつかのパッケージ、関数、データ構造を覚えればすぐに使える
- データの読み込み、加工、可視化、分析、報告まで一貫して使える
- データ分析のためのプログラミング言語として最も広く使われている


## まず使ってみよう

電卓のように使ってみましょう。

```{webr-r}
1 + 2 # 足し算
3 * 4 # かけ算
6 ** 2 # 累乗
sqrt(2) # 平方根
```

## 利点：関数化

プログラミングをするメリットの1つは関数化です。

```{webr-r}
# 関数mymeanを定義
mymean <- function(x) {
  x1 <- sum(x)
  x2 <- length(x)
  x <- x1 / x2
  return(x)
}
x <- 1:100 # 1から100までの数列
mymean(x)
```

関数として定義しておけば、何度も使いまわすことができます。

## 利点：繰り返し処理

サイコロを10回振って，出た目の平均を計算する，という処理を10回繰り返す。
```{webr-r}
# サイコロを作成し，投げる回数と試行回数を設定
dice <- 1:6; toss <- 10; trial <- 10
result <- numeric(trial)
# 繰り返し処理
for (i in 1:trial) {
  x <- sample(dice, toss, replace = TRUE)
  result[i] <- mean(x)
}
result
```

## 利点：分岐処理

条件によって処理を変えることもできます。
先ほどのサイコロの例で、平均値が3.5より大きい場合は「大きい」と表示する。
```{webr-r}
for (i in 1:trial) {
  if (result[i] > 3.5) {
    print("大きい") # 条件を満たすとき
  } else {
    print("小さい") # 条件を満たさないとき
  }
}
```

## エクササイズ

サイコロの出た目の平均値は，理論的には
$$
\frac{1+2+3+4+5+6}{6} = 3.5
$$

となりますが，実際にサイコロをたくさん降ると平均値が3.5になるか確認してください。

```{webr-r}
dice <- 1:6
toss <- 10
x <- sample(dice, toss, replace = TRUE)
mean(x)
```

## CUIとGUI

- **CUI** (Character User Interface) : 文字だけで操作するインターフェース
- *GUI* (Graphical User Interface) : グラフィカルなインターフェース

CUIはコマンドを覚える必要があるけれど、マウスのクリックとは異なり、書いておけばいつでも**再現**できる。
**再現性**がデータ分析で非常に重要なので、クリックがメインのアプリケーションは使わない。

## RStudioやVS Code

- とはいえ、コマンドを覚えるのは大変なので、RStudioやVS Codeのような統合開発環境を使うと便利です。
- あとは、MicrosoftのCopilotなどのAIがコードを書いてくれるツールもあります。
- Github CopilotがVS CodeやRsudioで使えるようになるととても便利です。


## Rの実行環境

1. 自分のPCにRなどをインストールする方法
  - ネット環境がなくても使える
  - いろいろインストールしなきゃならない
2. Posit CloudやGoogle Colarabolatoryを使う方法
  - インストール不要
  - ネットに繋げないと使えない

こだわりがなければ、Posit Cloudを使うのが一番簡単

# プレゼミの運営

## 授業の進め方

- 反転学習
  - 家で学習
  - 大学で宿題・発表
- 授業構成
  - ゼミによる報告 30分
  - 教員の解説 30分
  - Rを動かす 30分


## 来週からの予定

プレゼミ2回目

- 10月7日(月) 14:40-16:10
- 第2章 Rによる統計表の作成

プレゼミ3回目

- 10月14日(月祝) 14:40-16:10
- 記述統計量とグラフ

---

プレゼミ4回目

- 10月21日(月) 14:40-16:10
- 第3章 **回帰分析** (1)

プレゼミ5回目

- 10月28日(月) 14:40-16:10
- 第3章 **回帰分析** (2)

プレゼミ6回目

- 11月4日(月祝) 14:40-16:10
- **回帰分析**の実践（報告回)

---



プレゼミ7回目

- 11月11日(月) 14:40-16:10
- 第4章 **離散選択モデル**・質的データの分析 (1)

プレゼミ8回目


- 11月18日(月祝) 14:40-16:10
- 第4章 **離散選択モデル**・質的データの分析 (2)

プレゼミ9回目

- 11月25日(月) 14:40-16:10
- **離散選択モデル分析**の実践（報告回）

---

プレゼミ10回目 (重要)

- 12月2日(月祝) 14:40-16:10
- **差の差の分析**とパネルデータ分析 (1)

プレゼミ11回目 (重要)

- 12月9日(月) 14:40-16:10
- **差の差の分析**とパネルデータ分析 (2)

プレゼミ12回目

- 12月16日(月祝) 14:40-16:10
- **DiD**分析の実践（報告回）

---

プレゼミ13回目

- 12月23日(月) 14:40-16:10
- 第6章 **操作変数法**(難しい)

プレゼミ14回目

- 1月6日(月祝) 14:40-16:10
- 第7章 **傾向スコア法**(難しいけど重要)

プレゼミ15回目

- 1月20日(月) 14:40-16:10
- 最終報告会 (全チーム)


